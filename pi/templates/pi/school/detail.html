{% extends 'pi/common/detail.html' %}

{% load staticfiles %}
{% block page-header %}
<div>
{{ object.name }}

<div class="btn-group pull-right"> 
    <button
    	{% if object in user.myuserprofile.school_bookmarks.all %} 
    		class="btn btn-small ladda-button btn-primary"
    	{% else %}
    		class="btn btn-small ladda-button" 
    	{% endif %}

    	id="btn-school-bookmark" 
    	style="border-right:1px solid #fefefe;margin-right:1px;" 
    	data-style="expand-left" 
		data-size="l" 
		data-spinner-color="#333" 
		data-toggle="tooltip" 
		title="添加到我的收藏中"
	>
		<span class="ladda-label"></span>			
    	<i class="fa fa-heart-o"></i>
    	Bookmark
    </button>
    <button 
    	{% if object in user.myuserprofile.school_xouts.all %} 
    		class="btn btn-small ladda-button btn-primary"
    	{% else %}
    		class="btn btn-small ladda-button" 
    	{% endif %}
    	
		data-style="expand-right" 
		data-size="l" 
		data-spinner-color="#333" 		    
    	data-toggle="tooltip" 
    	title="我再也不想看见这个学校啦 >_<" 
    	id="btn-school-xout"
    >
		<span class="ladda-label"></span>			    
    	<i class="fa fa-thumbs-o-down"></i>
    	X-OUT
    </button>
	</div>
</div>
{% endblock %}

{% block detail-navbar %}
<ul class="nav navbar-nav" data-type="nav-side">
    <li class="active" id="nav-school-intro">
        <a href="{% url 'school_detail' object.id %}">学校简介
		<span class="pull-right"><i class="fa fa-angle-right"></i></span>
		</a>
    </li>

    <li class="" id="nav-school-hd">
        <a href="{% url 'school_detail_hd' object.id %}">学校百科
		<span class="pull-right"><i class="fa fa-angle-right"></i></span>
		</a>
    </li>

    <li class="" id="nav-school-major">
    	<a href="{% url 'school_detail_major' object.id %}">学校专业
		<span class="pull-right"><i class="fa fa-angle-right"></i></span>    	
    	</a>
    </li>

    <li class="" id="nav-school-admission">
		<a href="{% url 'school_detail_admission' object.id %}">
			往年录取分数线
			<span class="pull-right"><i class="fa fa-angle-right"></i></span>
		</a>
    </li>
    <li class="" id="nav-school-stream">
    	<a href="{% url 'school_detail_stream' object.id %}">
    	校园吧
		<span class="pull-right"><i class="fa fa-angle-right"></i></span>
    	</a>
    </li>
    <li class="" id="nav-school-weixin">
    	<a href="{% url 'school_weixin' object.id %}">
    	校园微信
		<span class="pull-right"><i class="fa fa-angle-right"></i></span>
    	</a>
    </li>    
</ul>
{% endblock %}

{% block breadcrumb %}
<ol class="breadcrumb">
	<li>
		<a href="{% url 'school_echart_map_filter' %}">全国</a>
	</li>
	<li>
		<a href="{% url 'analysis_school_by_province' object.province.id %}">{{object.province}}</a>
	</li>
	<li>
		<a href="{% url 'analysis_school_by_city' object.city.id %}">{{ object.city }}</a>
	</li>
	<li class="active">{{ object.name }}</li>
</ol>
{% endblock %}

{% block detail-content %}
	{# school introduction #}
	<section id="school-intro">
		<h4 class="my-h2-border"><i class="fa fa-university"></i>学校简介</h4>
		<div>
		{{ object.description|default:"暂无信息"|safe }}
		</div>		
	</section>


{% endblock %}

{% block detail-sidebar %}
	{# float to right, related #}
	<section>
		<h4>
			<i class="fa fa-map-marker"></i>
			同城大学推荐
		</h4>
		<ol class="">
			{% for s in related_schools %}
				<li><a href="{% url 'school_detail' s.school.id %}">
					{{ s.school }}</a>
					<span class="pull-right">({{s.rank}})</span>
				</li>
			{% endfor %}
		</ol>
	</section>
{% endblock %}

{% block custom_js %}
<script type="text/javascript">
	j$(document).ready(function(){
		j$('#btn-school-bookmark').click(function(){
			var l = Ladda.create(this);
	 		l.start();

	        // ajax to server to get a list of columns:4"markers that are within the viewport
	        j$.post("{% url 'user_bookmark' %}", // passed in from view
	            { 
	                'obj_id':{{ object.id }},
	                'action':1
	            }, 
	            function(resp) { // success callback
	            	if (resp['status'] == 'ok'){
	            		j$('#btn-school-bookmark').toggleClass('btn-primary');
	            		j$('#btn-school-xout').removeClass('btn-primary');
	            	}
	            	update_user_bookmarks();
	            },'json'
	        ).always(function(){     
	        	l.stop(); 	
	        });			
		});
		j$('#btn-school-xout').click(function(){
			var l = Ladda.create(this);
	 		l.start();

	        // ajax to server to get a list of columns:4"markers that are within the viewport
	        j$.post("{% url 'user_bookmark' %}", // passed in from view
	            { 
	                'obj_id':{{ object.id }},
	                'action':2
	            }, 
	            function(resp) { // success callback
	            	if (resp['status'] == 'ok'){
	            		j$('#btn-school-xout').toggleClass('btn-primary');
	            		j$('#btn-school-bookmark').removeClass('btn-primary');
	            	}
	            	update_user_bookmarks();
	            },'json'
	        ).always(function(){  
	        	l.stop();     	
	        });			
		});		

	});
</script>
{% endblock %}